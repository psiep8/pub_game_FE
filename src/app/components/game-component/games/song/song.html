<!-- src/app/components/game/games/song/song.html -->
<div class="song-container">

  <!-- ðŸ”¥ COUNTDOWN INIZIALE / TRA MANCHES -->
  @if (displayData?.inCountdown) {
    <div class="countdown-overlay">
      <div class="countdown-circle">
        <div class="countdown-number">{{ displayData.countdownValue }}</div>
        <div class="countdown-label">
          {{ displayData.currentPhase === 0 ? 'La canzone sta per iniziare...' : 'Prossima manche...' }}
        </div>
      </div>
    </div>
  }

  <!-- TITOLO -->
  <div class="song-header">
    <div class="music-icon">ðŸŽ¤</div>
    <h1 class="song-title">{{ displayData?.question || 'Indovina la canzone!' }}</h1>
  </div>

  <!-- BUZZ ALERT -->
  @if (displayData?.buzzedPlayer) {
    <div class="buzz-alert">
      <div class="alert-icon">ðŸ””</div>
      <div class="alert-content">
        <span class="alert-name">{{ displayData.buzzedPlayer }}</span>
        <span class="alert-text">SI Ãˆ PRENOTATO!</span>
      </div>
    </div>
  }

  <!-- VINILE CENTRALE -->
  <div class="vinyl-stage">
    <div class="vinyl-disc"
         [class.spinning]="isPlaying()"
         [style.transform]="'rotate(' + vinylRotation() + 'deg)'">

      <div class="vinyl-grooves"></div>

      <!-- ðŸ”¥ COVER con BLUR PROGRESSIVO -->
      <div class="vinyl-label">
        @if (displayData?.albumCover) {
          <img [src]="displayData.albumCover"
               [alt]="displayData.songTitle"
               class="album-cover"
               [style.filter]="'blur(' + blurAmount() + 'px)'">
        } @else {
          <div class="label-content">
            <div class="label-icon">ðŸŽµ</div>
            <div class="label-text">SONG</div>
          </div>
        }
      </div>

      <div class="vinyl-center"></div>
    </div>

    <!-- Braccio giradischi -->
    <div class="tonearm" [class.playing]="isPlaying()"></div>
  </div>

  <!-- INDICATORE MANCHES -->
  <div class="phases-indicator">
    <div class="phases-track">
      @for (phase of [1, 2, 3, 4]; track phase) {
        <div class="phase-dot"
             [class.active]="currentPhase() >= phase"
             [class.current]="currentPhase() === phase"
             [style.background]="currentPhase() >= phase ? getPhaseColor() : '#ddd'">

          <div class="phase-icon">{{ getPhaseIcon() }}</div>

          <div class="phase-label">
            @switch(phase) {
              @case(1) { <span>25%</span> }
              @case(2) { <span>50%</span> }
              @case(3) { <span>75%</span> }
              @case(4) { <span>100%</span> }
            }
          </div>
        </div>
      }
    </div>

    <div class="progress-bar">
      <div class="progress-fill"
           [style.width.%]="(currentPhase() / 4) * 100"
           [style.background]="getPhaseColor()"></div>
    </div>

    <div class="current-phase-label" [style.color]="getPhaseColor()">
      {{ getPhaseLabel() }}
    </div>
  </div>

  <!-- EQUALIZER quando suona -->
  @if (isPlaying()) {
    <div class="audio-status playing">
      <div class="equalizer">
        @for (bar of [1,2,3,4,5]; track bar) {
          <div class="eq-bar" [style.animation-delay]="(bar * 0.1) + 's'"></div>
        }
      </div>
      <p>ðŸŽµ In riproduzione...</p>
    </div>
  }

  <!-- ðŸ”¥ REVEAL FINALE (quando indovinano) -->
  @if (displayData?.revealed) {
    <div class="song-reveal">
      <div class="reveal-card">
        <div class="reveal-icon">ðŸŽ‰</div>
        <h2 class="reveal-title">{{ displayData.songTitle }}</h2>
        <p class="reveal-artist">{{ displayData.artist }}</p>
        @if (displayData.year) {
          <p class="reveal-year">{{ displayData.year }}</p>
        }
        <div class="reveal-cover">
          <img [src]="displayData.albumCover" alt="Album cover">
        </div>
      </div>
    </div>
  }

  <!-- TIMER -->
  <div class="timer-circle" [class.warning]="timer <= 30">
    <svg width="100" height="100">
      <circle cx="50" cy="50" r="45" class="timer-bg"></circle>
      <circle cx="50" cy="50" r="45"
              class="timer-progress"
              [style.stroke-dashoffset]="283 - (283 * timer / 160)"></circle>
    </svg>
    <div class="timer-value">{{ timer }}</div>
  </div>

</div>
